<head>
    <link rel="stylesheet" href="TemplateData/style.css">
    <script src="TemplateData/UnityProgress.js"></script>
    <script src="TemplateData/unityloader41.js"></script>
    <script>
        const APP_VERSION = "0.02";
        
        // Credits redirect handler - 50% chance for each URL
        function handleCreditsClick() {
            const urls = [
                "https://guns.lol/infernoytv",
                "https://feds.lol/infernoytv"
            ];
            const randomUrl = urls[Math.random() < 0.5 ? 0 : 1];
            window.open(randomUrl, '_blank');
            return false;
        }
        
        // Override window.open to intercept any URL navigation from Unity
        var originalWindowOpen = window.open;
        window.open = function(url, target, features) {
            // Intercept credits-related navigation
            if (url && (url.toLowerCase().includes('credit') || url.toLowerCase().includes('credits') || url.toLowerCase().includes('y8'))) {
                handleCreditsClick();
                return null;
            }
            // Allow other navigation
            return originalWindowOpen.apply(window, arguments);
        };
        
        // Intercept Unity postMessage calls
        var originalPostMessage = window.postMessage;
        if (originalPostMessage) {
            window.postMessage = function(message, targetOrigin) {
                if (message && typeof message === 'string' && (message.toLowerCase().includes('credit') || message.toLowerCase().includes('credits'))) {
                    handleCreditsClick();
                    return;
                }
                return originalPostMessage.apply(window, arguments);
            };
        }
        
        // Listen for messages from Unity
        window.addEventListener('message', function(event) {
            if (event.data && typeof event.data === 'string') {
                if (event.data.toLowerCase().includes('credit') || event.data.toLowerCase().includes('credits')) {
                    handleCreditsClick();
                    event.preventDefault();
                    return false;
                }
            }
        }, true);
        
        // Global function for Unity to call via SendMessage
        window.OpenCredits = function() {
            handleCreditsClick();
        };
        
        // Override Unity SendMessage if available (called after Unity loads)
        var gameInstance = UnityLoader.instantiate("gameContainer", "Build/slope.json", { 
            onProgress: UnityProgress, 
            Module: { 
                onRuntimeInitialized: function() { 
                    UnityProgress(gameInstance, "complete");
                    
                    // Try to intercept Unity's SendMessage function
                    if (gameInstance && gameInstance.SendMessage) {
                        var originalSendMessage = gameInstance.SendMessage;
                        gameInstance.SendMessage = function(gameObject, methodName, value) {
                            if (methodName && (methodName.toLowerCase().includes('credit') || methodName.toLowerCase().includes('credits'))) {
                                handleCreditsClick();
                                return;
                            }
                            return originalSendMessage.apply(this, arguments);
                        };
                    }
                } 
            } 
        });
    </script>
    <style>
        .alert {
          padding: 20px;
          background-color: #0096FF;
          color: white;
        }

        .closebtn {
          margin-left: 15px;
          color: white;
          p {text-align: center;}  
          font-weight: bold;
          float: right;
          font-size: 22px;
          line-height: 20px;
          cursor: pointer;
          transition: 0.3s;
        }

        .closebtn:hover {
          color: black;
        }
    </style>
</head>

<!--- 
Want to run or host yourself? Check out the source? 
https://github.com/cgolden15/Slope-Game/ 

Drop a star on the repo if you enjoy.
--->

<body style="margin: 0; overflow: hidden;">
    <div class="alert">
        <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
        Want to play tetris? <a href="https://goldenn.dev/tetris/">Click here!</a>
    </div>
    <div class="webgl-content">
        <div id="gameContainer" style="width: 100%; height: 100%; margin: 0;"></div>
    </div>
</body>
<!-- Flope game by y8 games, not me.-->
