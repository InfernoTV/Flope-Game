<head>
    <link rel="stylesheet" href="TemplateData/style.css">
    <script src="TemplateData/UnityProgress.js"></script>
    <script src="TemplateData/unityloader41.js"></script>
    <script>
        const APP_VERSION = "0.03";
        
        // Credits redirect handler - 50% chance for each URL
        function handleCreditsClick() {
            const urls = [
                "https://guns.lol/infernoytv",
                "https://feds.lol/infernoytv"
            ];
            const randomUrl = urls[Math.random() < 0.5 ? 0 : 1];
            window.open(randomUrl, '_blank');
            return false;
        }
        
        // Override window.open to intercept any URL navigation from Unity
        var originalWindowOpen = window.open;
        window.open = function(url, target, features) {
            // Intercept credits-related navigation
            if (url && (url.toLowerCase().includes('credit') || url.toLowerCase().includes('credits') || url.toLowerCase().includes('y8'))) {
                handleCreditsClick();
                return null;
            }
            // Allow other navigation
            return originalWindowOpen.apply(window, arguments);
        };
        
        // Intercept Unity postMessage calls
        var originalPostMessage = window.postMessage;
        if (originalPostMessage) {
            window.postMessage = function(message, targetOrigin) {
                if (message && typeof message === 'string' && (message.toLowerCase().includes('credit') || message.toLowerCase().includes('credits'))) {
                    handleCreditsClick();
                    return;
                }
                return originalPostMessage.apply(window, arguments);
            };
        }
        
        // Listen for messages from Unity
        window.addEventListener('message', function(event) {
            if (event.data && typeof event.data === 'string') {
                if (event.data.toLowerCase().includes('credit') || event.data.toLowerCase().includes('credits')) {
                    handleCreditsClick();
                    event.preventDefault();
                    return false;
                }
            }
        }, true);
        
        // Global function for Unity to call via SendMessage
        window.OpenCredits = function() {
            handleCreditsClick();
        };
        
        // Override Unity SendMessage if available (called after Unity loads)
        var gameInstance = UnityLoader.instantiate("gameContainer", "Build/slope.json", { 
            onProgress: UnityProgress, 
            Module: { 
                onRuntimeInitialized: function() { 
                    UnityProgress(gameInstance, "complete");
                    
                    // Apply color filter to canvas after Unity loads
                    setTimeout(function() {
                        var canvas = document.querySelector('#gameContainer canvas');
                        if (canvas) {
                            canvas.classList.add('pink-filter');
                        }
                    }, 500);
                    
                    // Block unwanted Unity UI interactions
                    setTimeout(function() {
                        var canvas = document.querySelector('#gameContainer canvas');
                        if (canvas) {
                            // Intercept clicks on UI areas
                            var originalClick = canvas.onclick;
                            canvas.addEventListener('click', function(e) {
                                var rect = canvas.getBoundingClientRect();
                                var x = e.clientX - rect.left;
                                var y = e.clientY - rect.top;
                                var width = rect.width;
                                var height = rect.height;
                                
                                // Block clicks in UI areas (adjust coordinates as needed)
                                // Bottom-left area (feedback, download buttons)
                                if (x < 300 && y > height - 60) {
                                    e.stopPropagation();
                                    e.preventDefault();
                                    return false;
                                }
                                // Bottom-right area (more games, Y8 logo)
                                if (x > width - 220 && y > height - 70) {
                                    e.stopPropagation();
                                    e.preventDefault();
                                    return false;
                                }
                                // Top-right area (leaderboard, login)
                                if (x > width - 280 && y < 60) {
                                    e.stopPropagation();
                                    e.preventDefault();
                                    return false;
                                }
                            }, true);
                        }
                    }, 1000);
                    
                    // Try to intercept Unity's SendMessage function
                    if (gameInstance && gameInstance.SendMessage) {
                        var originalSendMessage = gameInstance.SendMessage;
                        gameInstance.SendMessage = function(gameObject, methodName, value) {
                            // Block leaderboard, login, feedback, download, more games
                            if (methodName && (
                                methodName.toLowerCase().includes('leaderboard') ||
                                methodName.toLowerCase().includes('login') ||
                                methodName.toLowerCase().includes('feedback') ||
                                methodName.toLowerCase().includes('download') ||
                                methodName.toLowerCase().includes('moregames') ||
                                methodName.toLowerCase().includes('y8')
                            )) {
                                return; // Block these calls
                            }
                            if (methodName && (methodName.toLowerCase().includes('credit') || methodName.toLowerCase().includes('credits'))) {
                                handleCreditsClick();
                                return;
                            }
                            return originalSendMessage.apply(this, arguments);
                        };
                    }
                } 
            } 
        });
    </script>
    <style>
        .alert {
          padding: 20px;
          background-color: #0096FF;
          color: white;
        }

        .closebtn {
          margin-left: 15px;
          color: white;
          p {text-align: center;}  
          font-weight: bold;
          float: right;
          font-size: 22px;
          line-height: 20px;
          cursor: pointer;
          transition: 0.3s;
        }

        .closebtn:hover {
          color: black;
        }
        
        /* UI Element Hiding Overlays */
        #gameContainer {
            position: relative;
        }
        
        /* Overlay to hide buttons and UI elements */
        .ui-overlay {
            position: absolute;
            z-index: 9999;
            pointer-events: auto;
            background: transparent;
        }
        
        /* Hide feedback button (typically bottom-left) */
        .overlay-feedback {
            bottom: 10px;
            left: 10px;
            width: 120px;
            height: 40px;
        }
        
        /* Hide download button (typically bottom-left, next to feedback) */
        .overlay-download {
            bottom: 10px;
            left: 140px;
            width: 150px;
            height: 40px;
        }
        
        /* Hide more games / Y8 logo (typically bottom-right) */
        .overlay-moregames {
            bottom: 10px;
            right: 10px;
            width: 200px;
            height: 60px;
        }
        
        /* Hide leaderboard (typically top-center or top-right) */
        .overlay-leaderboard {
            top: 10px;
            right: 10px;
            width: 150px;
            height: 40px;
        }
        
        /* Hide login (typically top-right) */
        .overlay-login {
            top: 10px;
            right: 170px;
            width: 100px;
            height: 40px;
        }
        
        /* Color filter to change green to light pastel pink */
        #gameContainer canvas {
            filter: hue-rotate(280deg) saturate(0.5) brightness(1.2);
            /* This shifts green hues toward pink, reduces saturation, and brightens */
        }
        
        /* Alternative: More aggressive color replacement */
        .pink-filter {
            filter: hue-rotate(300deg) saturate(0.6) brightness(1.3) contrast(0.9);
        }
    </style>
</head>

<!--- 
Want to run or host yourself? Check out the source? 
https://github.com/cgolden15/Slope-Game/ 

Drop a star on the repo if you enjoy.
--->

<body style="margin: 0; overflow: hidden;">
    <div class="alert">
        <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
        Want to play tetris? <a href="https://goldenn.dev/tetris/">Click here!</a>
    </div>
    <div class="webgl-content">
        <div id="gameContainer" style="width: 100%; height: 100%; margin: 0;">
            <!-- Overlays to hide and block UI elements -->
            <div class="ui-overlay overlay-feedback" onclick="event.stopPropagation(); return false;" onmousedown="event.stopPropagation(); return false;"></div>
            <div class="ui-overlay overlay-download" onclick="event.stopPropagation(); return false;" onmousedown="event.stopPropagation(); return false;"></div>
            <div class="ui-overlay overlay-moregames" onclick="event.stopPropagation(); return false;" onmousedown="event.stopPropagation(); return false;"></div>
            <div class="ui-overlay overlay-leaderboard" onclick="event.stopPropagation(); return false;" onmousedown="event.stopPropagation(); return false;"></div>
            <div class="ui-overlay overlay-login" onclick="event.stopPropagation(); return false;" onmousedown="event.stopPropagation(); return false;"></div>
        </div>
    </div>
</body>
<!-- Flope game by y8 games, not me.-->
